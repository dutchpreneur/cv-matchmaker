<!-- File Upload Section -->
<section id="upload" class="upload-section">
    <div class="upload-container">
        <div class="upload-form">
            <h2><i class="fas fa-upload"></i> Upload Job Vacancy</h2>
            <form id="job-ad-form">
                <label for="job-ad">Upload Job Description:</label>
                <input type="file" id="job-ad" name="job-ad" required>
            </form>
        </div>
        <div class="upload-form">
            <h2><i class="fas fa-file-upload"></i> Upload Candidate CVs</h2>
            <form id="cv-form">
                <label for="cv">Upload CVs (multiple allowed):</label>
                <input type="file" id="cv" name="cv" multiple required>
            </form>
        </div>
        <div class="upload-form">
            <h2><i class="fas fa-envelope"></i> Your Email Address</h2>
            <form id="email-form">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </form>
        </div>
        <div class="run-analysis">
            <h2><i class="fas fa-play-circle"></i> Run Candidate Analysis</h2>
            <button id="run-analysis-btn" class="btn"><i class="fas fa-play"></i> Run Analysis</button>
        </div>
    </div>
</section>

<script>
document.getElementById('run-analysis-btn').addEventListener('click', async () => {
    const jobAd = document.getElementById('job-ad').files[0];
    const cvs = document.getElementById('cv').files;
    const email = document.getElementById('email').value;

    if (!jobAd || cvs.length === 0 || !email) {
        alert('Please upload job description, candidate CVs, and enter your email address.');
        return;
    }

    const formData = new FormData();
    formData.append('job-ad', jobAd);
    for (let i = 0; i < cvs.length; i++) {
        formData.append('cv', cvs[i]);
    }
    formData.append('email', email);

    try {
        const response = await fetch('/api/run-analysis', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            alert('Analysis is being processed. Results will be sent to your email.');
        } else {
            alert('There was an error processing your request. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('There was an error processing your request. Please try again.');
    }
});
</script>
